
<div class="container">
    <div id="toolbar-self" class="btn-group">
        <select class="initsearch cmotsidselect" style="width: 150px; height: 30px; border: solid 1px #ADADAD;border-radius: 4px;">
            <option value="">请选择人员</option>
        </select>
        <input class="initsearch cmorderdateselect" type="text" style="width: 150px;height: 30px;" placeholder="预约日期">
        <select class="initsearch cmostoreidselect" style="width: 200px; height: 30px; border: solid 1px #ADADAD;border-radius: 4px;">
            <option value="">请选择门店</option>
        </select>
        <select class="initsearch cmostatusflgselect" style="width: 150px; height: 30px; border: solid 1px #ADADAD;border-radius: 4px;">
            <option value="">请选择状态</option>
            <option value="0">待确认</option>
            <option value="1">已确认</option>
        </select>
    </div>
    <table id="table-self-view6"></table>
</div>
<input type = "button" value = "test" ng-click="clickToAddress('dddd')">
<script>
    var httputil = new jsutil(httpurl);
    var authinfo =   httputil.getauthinfo();
    $(function () {
        selectinit();
        $(".initsearch").change(function(){
            changeserch();
        });
        $(".cmorderdateselect").datetimepicker({
            format: 'yyyy-mm-dd',
            weekStart: 1,
            autoclose: true,
            startView: 2,
            minView: 2,
            forceParse: false,
            language: 'zh-CN'
        });

        $('#table-self-view6').bootstrapTable( {
            method: 'get',
            url: httpurl + '/morder/QueryMemOrderBeanList',
            height: 600,
            width:500,
            toolbar: '#toolbar-self',    //工具按钮用哪个容器
            striped: true,
            pagination: true,
            pageList: [10,20,50],
            pageSize:10,
            pageNumber:1,
            sortable: true,      //是否启用排序
            sortName: "cmoid",
            sortOrder: "desc",
            dataType: "jsonp",
            jsonp: 'callback',
            dataField: "rows",
            queryParams: function (params) {
                params.data = authinfo;
                params.cmotsid = $(".cmotsidselect").val();
                params.cmostoreid = $(".cmostoreidselect").val();
                params.cmostatusflg = $(".cmostatusflgselect").val();
                params.cmorderdate = ($(".cmorderdateselect").val()).toString().replace(/-/gm,'');
                return params;
            },
            queryParamsType: "limit",
            sidePagination:'server',//设置为服务器端分页
            contentType: "application/x-www-form-urlencoded",
            search: true,  //搜索
            showColumns: false,
            showRefresh: true,     //是否显示刷新按钮
            showFooter: true,
            columns: [{
                field: 'cmoid',
                title: 'cmoid',
                visible: false, //隐藏列
                width: 80,
                align: 'left',
                valign: 'middle'
            }, {
                field: 'cmorderdate',
                title: '日期',
                width: 100,
                align: 'left',
                valign: 'middle',
                sortable: true,
                formatter: cmorderdateFormatter
            }, {
                field: 'cmordertime',
                title: '时间',
                width: 120,
                align: 'left',
                valign: 'middle',
                sortable: true,
                formatter: cmordertimeFormatter
            }, {
                field: 'cmotsid',
                title: 'cmotsid',
                visible: false, //隐藏列
                width: 80,
                align: 'left',
                valign: 'middle'
            },{
                field: 'tsname',
                title: '员工',
                sortable: true,
                width: 100,
                align: 'left',
                valign: 'middle',
                sortable: true,
                formatter: tsnameFormatter
            }, {
                field: 'tstelno',
                title: '电话',
                width: 120,
                align: 'left',
                valign: 'middle',
                sortable: true
            }, {
                field: 'cmostoreid',
                title: 'cmostoreid',
                visible: false, //隐藏列
                width: 80,
                align: 'left',
                valign: 'middle'
            },{
                field: 'sstorename',
                title: '门店',
                width: 200,
                align: 'left',
                valign: 'middle',
                sortable: true,
                formatter: sstorenameFormatter
            }, {
                field: 'stel',
                title: '门店电话',
                width: 80,
                align: 'left',
                valign: 'middle',
                sortable: true
            }, {
                field: 'saddress',
                title: '地址',
                width: 300,
                align: 'left',
                valign: 'middle',
                sortable: true
            }, {
                field: 'cmostatusflg',
                title: '状态',
                width: 80,
                align: 'left',
                valign: 'middle',
                sortable: true,
                formatter: function(value, row, index){
                    if(value == 0){
                        return "待确认";
                    }else if(value == 1){
                        return "已确认";
                    }else if(value == 2){
                        return "已完成";
                    }
                }
            },{
                field: 'operate',
                title: '操作',
                width: 180,
                align: 'center',
                valign: 'middle',
                formatter: operateFormatter
            }],
            formatLoadingMessage: function () {
                return '正在努力地加载数据中，请稍候……';
            },
            formatRecordsPerPage: function (pageNumber) {
                return '每页显示 ' + pageNumber + ' 条记录';
            },
            formatShowingRows: function (pageFrom, pageTo, totalRows) {
                return '显示第 ' + pageFrom + ' 到第 ' + pageTo + ' 条记录，总共 ' + totalRows + ' 条记录';
            },
            formatSearch: function () {
                return '搜索';
            },
            formatNoMatches: function () {
                return '没有找到匹配的记录';
            },
            formatPaginationSwitch: function () {
                return '隐藏/显示分页';
            },
            formatRefresh: function () {
                return '刷新';
            },
            formatToggle: function () {
                return '切换';
            },
            formatColumns: function () {
                return '列';
            },
            onLoadSuccess:function(){
 
  
            },
            onLoadError: function () {
            }
          
        });
    });

    function cmorderdateFormatter(value, row) {
        var fmthtm = value ;
        fmthtm += '<a href="javascript: void(0);" onclick="fnUpdatePartInfo('+row.cmoid+',1);">'+
                  '<span class="glyphicon glyphicon-file" aria-hidden="true"></span></a>';
        return fmthtm;
    }
    function cmordertimeFormatter(value, row) {
        var fmthtm = value ;
        fmthtm += '<a href="javascript: void(0);" onclick="fnUpdatePartInfo('+row.cmoid+',2);">'+
                '<span class="glyphicon glyphicon-file" aria-hidden="true"></span></a>';
        return fmthtm;
    }

    function tsnameFormatter(value, row) {
        var fmthtm = value ;
        fmthtm += '<a href="javascript: void(0);" onclick="fnUpdatePartInfo('+row.cmoid+',3);">'+
                '<span class="glyphicon glyphicon-file" aria-hidden="true"></span></a>';
        return fmthtm;
    }

    function sstorenameFormatter(value, row) {
        var fmthtm = value ;
        fmthtm += '<a href="javascript: void(0);" onclick="fnUpdatePartInfo('+row.cmoid+',4);">'+
                '<span class="glyphicon glyphicon-file" aria-hidden="true"></span></a>';
        return fmthtm;
    }

    function operateFormatter(value, row) {
       var opthtm = '<button type="button" class="btn btn-default btn-xs" onclick="cancelmorder('+row.cmoid+')">'+
                    '<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>取消</button>';
        return opthtm;
    }

    function cancelmorder(cmoid) {
        var y = confirm("确认取消吗");
        if(y) {
            var jsonpara = {};
            jsonpara.cmoid = cmoid;
            httputil.httpget("/morder/DelCcMemOrder", jsonpara, cancelmorderCallBack);
            
        }
    }

    function cancelmorderCallBack(data) {
        if(data.status >= 0) {
            alert("取消成功");
            $('#table-self-view6').bootstrapTable('refresh',{url:httpurl + '/morder/QueryMemOrderBeanList?data='+authinfo});
        } else {
            alert("取消失败");
        }
    }

    function fnUpdatePartInfo(cmoid,utype) {
        var jsonpara = {};
        jsonpara.cmoid = cmoid;
        jsonpara.utype = utype;
        httputil.httpget("/morder/GetOrderPartInfo", jsonpara, fnUpdatePartInfoCallBack);
    }

    function fnUpdatePartInfoCallBack (data) {
        var dataRows = data.orderMonth;

    }

    function selectinit() {
        httputil.httpget("/morder/QueryCcStoreList", {}, cmostoreidselectinitCallBack);
        httputil.httpget("/morder/QueryCcTechnologyStaffListAll", {}, cmotsidselectinitCallBack);
    }

    function cmostoreidselectinitCallBack(data) {
        var dataRows = data.data;
        var optionHtm = "<option value=''>请选择门店</option>";
        $(".cmostoreidselect").html(optionHtm);
        if(dataRows.length > 0) {
            for(var i = 0; i<dataRows.length; i++ ) {
                var drow = dataRows[i];
                optionHtm = optionHtm + "<option value='"+drow.sid+"'>"+ drow.sstorename +"</option>";
            }
        }
        $(".cmostoreidselect").html(optionHtm);
    }

    function cmotsidselectinitCallBack(data) {
        var dataRows = data.data;
        var optionHtm = "<option value=''>请选择人员</option>";
        $(".cmotsidselect").html(optionHtm);
        if(dataRows.length > 0) {
            for(var i = 0; i<dataRows.length; i++ ) {
                var drow = dataRows[i];
                optionHtm = optionHtm + "<option value='"+drow.tsid+"'>"+ drow.tsname +"</option>";
            }
        }
        $(".cmotsidselect").html(optionHtm);
    }

    function changeserch() {
        var qurl = httpurl + '/morder/QueryMemOrderBeanList';
        $('#table-self-view6').bootstrapTable('refresh', {url: qurl});
    }

</script>
