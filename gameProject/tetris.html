<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>tetris</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="title" content="" />
    <meta name="author" content="-06" />
    <meta name="Copyright" content="" />
    <!-- 让IE浏览器用最高级内核渲染页面 还有用 Chrome 框架的页面用webkit 内核
    ================================================== -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <!-- IOS6全屏 Chrome高版本全屏
    ================================================== -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <!-- 让360双核浏览器用webkit内核渲染页面
    ================================================== -->
    <meta name="renderer" content="webkit">
    <!-- Mobile Specific Metas
    ================================================== -->
    <!-- !!!注意 minimal-ui 是IOS7.1的新属性，最小化浏览器UI -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta name="format-detection" content="telephone=no">
    <!-- 启用360浏览器的极速模式(webkit) -->
    <meta name="renderer" content="webkit">
    <!-- 避免IE使用兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓 -->
    <meta name="HandheldFriendly" content="true">
    <!-- 微软的老式浏览器 -->
    <meta name="MobileOptimized" content="320">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 点击无高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        html,body{
            font-size: 14px;
        }
        .box{
            height: 500px;
        }
        .main{
            text-align: center;
            padding-top: 10px;
        }
        .main table{
            border-spacing: 0;
            border-collapse: collapse;
            margin: auto;
        }
        .main table td{
            width: 20px;
            height: 20px;
            border: 1px solid #eee;
        }
        .main table td.on{
            background: #f00;
        }
        .main table td.off{
            background: #f00;
        }
    </style>
</head>
<body>
    <div class="box">
        <div class="main">

        </div>
    </div>
</body>
<script>
    var w          = 10;
    var h          = 18;
    var CHANGE     = 38;
    var RIGHT      = 39;
    var DOWN       = 40;
    var LEFT       = 37;
    var SPACE      = 32;
    var core       = 0;
    var kindNum    = 7;
    var clearFlg   = 0;
    var speed      = 500;
    var isStop     = true;
    var isBottom   = false;
    var unit       = new Array(4);
    var mObj       = function(){
        this.main = document.getElementsByClassName("main")[0];
    };
    mObj.prototype = {
        initPage  : function(){
            var html = [];
            html.push("<table>");
            for(var i=0; i<h; i++){
                html.push("<tr>");
                for(var j=0; j<w; j++){
                    html.push("<td id=\"box-"+i+"-"+j+"\"></td>");
                }
                html.push("</tr>");
            }
            html.push("</table>");
            this.main.innerHTML = html.join("");
        },
        randomNum : function(){
            return Math.random()*(kindNum-1);
        },
        getUnit   : function(){
            var mainThis = this;
            var num      = parseInt(mainThis.randomNum());
            console.log(num);
            switch (num){
                case 0:
                    unit[0] = {"x":0,"y":4};
                    unit[1] = {"x":0,"y":5};
                    unit[2] = {"x":1,"y":4};
                    unit[3] = {"x":1,"y":5};
                    break;
                case 1:
                    unit[0] = {"x":0,"y":4};
                    unit[1] = {"x":1,"y":4};
                    unit[2] = {"x":1,"y":5};
                    unit[3] = {"x":2,"y":5};
                    break;
                case 2:
                    unit[0] = {"x":0,"y":4};
                    unit[1] = {"x":1,"y":4};
                    unit[2] = {"x":2,"y":4};
                    unit[3] = {"x":2,"y":5};
                    break;
                case 3:
                    unit[0] = {"x":0,"y":4};
                    unit[1] = {"x":1,"y":4};
                    unit[2] = {"x":2,"y":4};
                    unit[3] = {"x":1,"y":5};
                    break;
                case 4:
                    unit[0] = {"x":0,"y":4};
                    unit[1] = {"x":1,"y":4};
                    unit[2] = {"x":2,"y":4};
                    unit[3] = {"x":3,"y":4};
                    break;
                case 5:
                    unit[0] = {"x":0,"y":5};
                    unit[1] = {"x":1,"y":5};
                    unit[2] = {"x":1,"y":4};
                    unit[3] = {"x":2,"y":4};
                    break;
                case 6:
                    unit[0] = {"x":0,"y":5};
                    unit[1] = {"x":1,"y":5};
                    unit[2] = {"x":2,"y":5};
                    unit[3] = {"x":2,"y":4};
                    break;
            }
            for(var i=0; i<unit.length; i++){
                document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "on";
            }
        },
        control   : function(){
            var mainThis = this;
            document.onkeydown = function(e){
                switch (e.keyCode){
                    case CHANGE:

                        break;
                    case RIGHT:
                        for(var i=0; i<unit.length; i++){
                            if(unit[i].y == (w-1)){
                                return false;
                            }
                        }
                        for(var i=0; i<unit.length; i++){
                            document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "";
                            unit[i].y++;
                        }
                        for(var i=0; i<unit.length; i++){
                            document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "on";
                        }
                        break;
                    case DOWN:
                        for(var i=0; i<unit.length; i++){
                            if(unit[i].x == (h-1)){
                                return false;
                            }
                        }
                        for(var i=0; i<unit.length; i++){
                            document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "";
                            unit[i].x++;
                        }
                        for(var i=0; i<unit.length; i++){
                            document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "on";
                        }
                        break;
                    case LEFT:
                        for(var i=0; i<unit.length; i++){
                            if(unit[i].y == 0){
                                return false;
                            }
                        }
                        for(var i=0; i<unit.length; i++){
                            document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "";
                            unit[i].y--;
                        }
                        for(var i=0; i<unit.length; i++){
                            document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "on";
                        }
                        break;
                    case SPACE:
                        if(isStop){
                            mainThis.move();
                            isStop = false;
                        }else{
                            clearInterval(clearFlg);
                            isStop = true;
                        }
                        break;
                    default:
                        console.log(e.keyCode);
                        break;
                }
            }
        },
        hasClass  : function(ele,cls){
            return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
        },
        move      : function(){
            var mainThis = this;
            clearFlg = setInterval(function(){
                for(var i=0; i<unit.length; i++){
                    if( mainThis.hasClass(document.getElementById("box-"+(unit[i].x+1)+"-"+unit[i].y),"off") || unit[i].x == (h-1)){
                        document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "off";
                        isBottom = true;
                    }
                }
                if(isBottom){
                    mainThis.getUnit();
                    isBottom = false;
                }else{
                    for(var i=0; i<unit.length; i++){
                        document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "";
                        unit[i].x++;
                    }
                    for(var i=0; i<unit.length; i++){
                        document.getElementById("box-"+unit[i].x+"-"+unit[i].y).className = "on";
                    }
                }
            },speed);
        },
        init      : function(){
            this.initPage();
            this.getUnit();
            this.control();
        }
    };
    var mainObj    = new mObj();
    mainObj.init();
</script>
</html>